      # 5. 修复Gradle项目结构 (最终优化版)
      - name: Fix Gradle project structure
        working-directory: ${{ env.PROJECT_DIR }}
        run: |
          # 备份关键文件
          echo "正在备份项目文件..."
          mkdir -p ../temp_backup
          cp -r lib pubspec.yaml ../temp_backup/
          [ -d "assets" ] && cp -r assets ../temp_backup/
          [ -d "test" ] && cp -r test ../temp_backup/
          
          # 删除旧平台目录
          echo "清理旧平台配置..."
          rm -rf android ios .dart_tool .idea
          
          # 创建临时目录用于重建项目
          echo "重建项目结构..."
          cd ..
          flutter create \
            --platforms android,ios \
            --project-name ${{ env.PROJECT_DIR }} \
            --org ${{ env.ORG_NAME }} \
            --overwrite \
            temp_flutter_project
          
          # 将重建的项目文件复制回原目录
          echo "恢复项目结构..."
          cp -r temp_flutter_project/. ${{ env.PROJECT_DIR }}/
          rm -rf temp_flutter_project
          
          # 恢复原有代码和配置
          echo "恢复原有代码..."
          cd ${{ env.PROJECT_DIR }}
          rm -rf lib test
          cp -r ../temp_backup/lib .
          [ -d "../temp_backup/test" ] && cp -r ../temp_backup/test .
          cp ../temp_backup/pubspec.yaml .
          [ -d "../temp_backup/assets" ] && cp -r ../temp_backup/assets .
          
          # 清理备份
          rm -rf ../temp_backup
          echo "项目重建完成！"
